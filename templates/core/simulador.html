{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}
{% block description %}{{ meta_description }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/simulador.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section del Simulador -->
<section class="hero hero--video">
    <div class="hero__video-container">
        <video class="hero__video" autoplay loop muted playsinline>
            <source src="/media/videos/simulador3.mp4" type="video/mp4">
        </video>
    </div>
</section>

<!-- Contenido Principal del Simulador -->
<section class="simulador-content">
    <div class="container">
        <div class="simulador-grid">
            <!-- Panel del Formulario -->
            <div class="simulador-form-panel">
                <div class="wizard-container">
                    <div class="wizard-header">
                        <div class="wizard-steps">
                            <div class="step active" data-step="1">
                                <span class="step-number">1</span>
                                <span class="step-title">Ubicaci√≥n</span>
                            </div>
                            <div class="step" data-step="2">
                                <span class="step-number">2</span>
                                <span class="step-title">Consumo</span>
                            </div>
                            <div class="step" data-step="3">
                                <span class="step-number">3</span>
                                <span class="step-title">Resultados</span>
                            </div>
                        </div>
                    </div>

                    <form id="simulador-form" class="wizard-form">
                        <!-- Paso 1: Ubicaci√≥n e Irradiaci√≥n Solar -->
                        <div class="wizard-step active" data-step="1">
                            <h3 class="step-heading">Ubicaci√≥n e Irradiaci√≥n Solar</h3>
                            <p class="step-description">
                                La ubicaci√≥n geogr√°fica y orientaci√≥n de tu tejado son claves para maximizar la producci√≥n solar.
                            </p>
                            
                            <div class="form-group">
                                <label for="ubicacion" class="form-label">Provincia *</label>
                                <select id="ubicacion" name="ubicacion" class="form-input" required>
                                    <option value="">Selecciona tu provincia</option>
                                    <option value="caba">Ciudad Aut√≥noma de Buenos Aires</option>
                                    <option value="buenos_aires">Buenos Aires</option>
                                    <option value="catamarca">Catamarca</option>
                                    <option value="chaco">Chaco</option>
                                    <option value="chubut">Chubut</option>
                                    <option value="cordoba">C√≥rdoba</option>
                                    <option value="corrientes">Corrientes</option>
                                    <option value="entre_rios">Entre R√≠os</option>
                                    <option value="formosa">Formosa</option>
                                    <option value="jujuy">Jujuy</option>
                                    <option value="la_pampa">La Pampa</option>
                                    <option value="la_rioja">La Rioja</option>
                                    <option value="mendoza">Mendoza</option>
                                    <option value="misiones">Misiones</option>
                                    <option value="neuquen">Neuqu√©n</option>
                                    <option value="rio_negro">R√≠o Negro</option>
                                    <option value="salta">Salta</option>
                                    <option value="san_juan">San Juan</option>
                                    <option value="san_luis">San Luis</option>
                                    <option value="santa_cruz">Santa Cruz</option>
                                    <option value="santa_fe">Santa Fe</option>
                                    <option value="santiago_del_estero">Santiago del Estero</option>
                                    <option value="tierra_del_fuego">Tierra del Fuego</option>
                                    <option value="tucuman">Tucum√°n</option>
                                </select>
                            </div>

                            <!-- Mapa de Google Maps -->
                            <div class="form-group">
                                <div class="google-map-container google-map-container-hidden" id="google-map-container">
                                    <h4>Tu Ubicaci√≥n</h4>
                                    <div class="map-wrapper">
                                        <iframe id="google-map" 
                                                width="100%" 
                                                height="300" 
class="simulador-map-iframe" 
                                                allowfullscreen="" 
                                                loading="lazy" 
                                                referrerpolicy="no-referrer-when-downgrade">
                                        </iframe>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="orientacion" class="form-label">Orientaci√≥n del tejado *</label>
                                <div class="orientation-selector">
                                    <div class="orientation-grid">
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="N" checked required>
                                            <span class="orientation-card optimal">
                                                <img src="{% static 'images/simulador/casa-norte.svg' %}" alt="Norte" class="orientation-house">
                                                <span class="orientation-text">Norte</span>
                                                <span class="orientation-efficiency">100%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="NE" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-noreste.svg' %}" alt="Noreste" class="orientation-house">
                                                <span class="orientation-text">Noreste</span>
                                                <span class="orientation-efficiency">95%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="E" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-este.svg' %}" alt="Este" class="orientation-house">
                                                <span class="orientation-text">Este</span>
                                                <span class="orientation-efficiency">85%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="SE" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-sureste.svg' %}" alt="Sureste" class="orientation-house">
                                                <span class="orientation-text">Sureste</span>
                                                <span class="orientation-efficiency">70%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="S" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-sur.svg' %}" alt="Sur" class="orientation-house">
                                                <span class="orientation-text">Sur</span>
                                                <span class="orientation-efficiency">60%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="SO" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-suroeste.svg' %}" alt="Suroeste" class="orientation-house">
                                                <span class="orientation-text">Suroeste</span>
                                                <span class="orientation-efficiency">70%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="O" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-oeste.svg' %}" alt="Oeste" class="orientation-house">
                                                <span class="orientation-text">Oeste</span>
                                                <span class="orientation-efficiency">85%</span>
                                            </span>
                                        </label>
                                        <label class="orientation-option">
                                            <input type="radio" name="orientacion" value="NO" required>
                                            <span class="orientation-card">
                                                <img src="{% static 'images/simulador/casa-noroeste.svg' %}" alt="Noroeste" class="orientation-house">
                                                <span class="orientation-text">Noroeste</span>
                                                <span class="orientation-efficiency">95%</span>
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Selector de √Ångulo del Tejado -->
                            <div class="form-group">
                                <label class="form-label">√Ångulo de Inclinaci√≥n del Tejado *</label>
                                <div class="angle-selector">
                                    <div class="angle-grid">
                                        <label class="angle-option">
                                            <input type="radio" name="inclinacion" value="0" required>
                                            <span class="angle-card">
                                                <img src="{% static 'images/simulador/angulo-0.svg' %}" 
                                                     alt="0 grados" 
                                                     class="angle-image">
                                                <span class="angle-text">0¬∞</span>
                                                <span class="angle-efficiency">85%</span>
                                            </span>
                                        </label>
                                        <label class="angle-option">
                                            <input type="radio" name="inclinacion" value="15" required>
                                            <span class="angle-card">
                                                <img src="{% static 'images/simulador/angulo-15.svg' %}" 
                                                     alt="15 grados" 
                                                     class="angle-image">
                                                <span class="angle-text">15¬∞</span>
                                                <span class="angle-efficiency">92%</span>
                                            </span>
                                        </label>
                                        <label class="angle-option">
                                            <input type="radio" name="inclinacion" value="30" checked required>
                                            <span class="angle-card optimal">
                                                <img src="{% static 'images/simulador/angulo-30.svg' %}" 
                                                     alt="30 grados" 
                                                     class="angle-image">
                                                <span class="angle-text">30¬∞</span>
                                                <span class="angle-efficiency">100%</span>
                                                <span class="angle-badge">‚≠ê √ìPTIMO</span>
                                            </span>
                                        </label>
                                        <label class="angle-option">
                                            <input type="radio" name="inclinacion" value="45" required>
                                            <span class="angle-card">
                                                <img src="{% static 'images/simulador/angulo-45.svg' %}" 
                                                     alt="45 grados" 
                                                     class="angle-image">
                                                <span class="angle-text">45¬∞</span>
                                                <span class="angle-efficiency">90%</span>
                                            </span>
                                        </label>
                                        <label class="angle-option">
                                            <input type="radio" name="inclinacion" value="60" required>
                                            <span class="angle-card">
                                                <img src="{% static 'images/simulador/angulo-60.svg' %}" 
                                                     alt="60 grados" 
                                                     class="angle-image">
                                                <span class="angle-text">60¬∞</span>
                                                <span class="angle-efficiency">80%</span>
                                            </span>
                                        </label>
                                    </div>
                                </div>
                                <small class="form-help">
                                    El √°ngulo √≥ptimo para Argentina es 30¬∞. Los paneles ser√°n m√°s eficientes con orientaci√≥n Norte y √°ngulo de 30¬∞.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="superficie" class="form-label">
                                    Superficie disponible (m¬≤) *
                                </label>
                                <input type="number" 
                                       id="superficie" 
                                       name="superficie" 
                                       class="form-input" 
                                       placeholder="Ej: 50" 
                                       min="10" 
                                       max="500"
                                       required>
                                <small class="form-help">
                                    Cada panel solar ocupa aproximadamente 2m¬≤. M√≠nimo recomendado: 20m¬≤
                                </small>
                            </div>

                            <div class="superficie-helper">
                                <h4>Gu√≠a de superficies t√≠picas:</h4>
                                <div class="superficie-examples">
                                    <div class="superficie-example">
                                        <strong>Casa peque√±a:</strong> 30-50 m¬≤
                                    </div>
                                    <div class="superficie-example">
                                        <strong>Casa mediana:</strong> 50-80 m¬≤
                                    </div>
                                    <div class="superficie-example">
                                        <strong>Casa grande:</strong> 80-150 m¬≤
                                    </div>
                                    <div class="superficie-example">
                                        <strong>Naves/Industria:</strong> 200+ m¬≤
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Paso 2: Consumo Energ√©tico -->
                        <div class="wizard-step" data-step="2">
                            <h3 class="step-heading">Consumo Energ√©tico Anual</h3>
                            <p class="step-description">
                                Introduce tu consumo anual de electricidad. Lo puedes encontrar en tu factura el√©ctrica.
                            </p>
                            
                            <div class="form-group">
                                <label for="consumo_anual" class="form-label">
                                    Consumo anual (kWh/a√±o) *
                                </label>
                                <input type="number" 
                                       id="consumo_anual" 
                                       name="consumo_anual" 
                                       class="form-input" 
                                       placeholder="Ej: 4500" 
                                       min="500" 
                                       max="50000"
                                       required>
                                <small class="form-help">
                                    Consumo t√≠pico: Vivienda peque√±a (2000-3000 kWh), Media (3000-5000 kWh), Grande (5000+ kWh)
                                </small>
                            </div>

                            <div class="consumo-estimador">
                                <h4>¬øNo conoces tu consumo? Calculadora r√°pida:</h4>
                                <div class="estimador-grid">
                                    <div class="form-group">
                                        <label for="habitantes" class="form-label">Habitantes</label>
                                        <select id="habitantes" class="form-input">
                                            <option value="">Seleccionar</option>
                                            <option value="1">1 persona</option>
                                            <option value="2">2 personas</option>
                                            <option value="3">3 personas</option>
                                            <option value="4">4 personas</option>
                                            <option value="5">5+ personas</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="tipo_vivienda" class="form-label">Tipo de vivienda</label>
                                        <select id="tipo_vivienda" class="form-input">
                                            <option value="">Seleccionar</option>
                                            <option value="piso">Piso/Apartamento</option>
                                            <option value="casa">Casa unifamiliar</option>
                                            <option value="chalet">Chalet/Villa</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="button" id="calcular-consumo" class="btn btn--secondary">
                                    Calcular Consumo Estimado
                                </button>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn--primary btn--large">
                                    <span class="btn-text">Calcular Simulaci√≥n</span>
                                    <span class="btn-loader btn-loader-hidden">
                                        <svg class="spinner" width="20" height="20" viewBox="0 0 24 24">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="60" stroke-dashoffset="60">
                                                <animate attributeName="stroke-dashoffset" values="60;0;60" dur="1.5s" repeatCount="indefinite"/>
                                            </circle>
                                        </svg>
                                        Calculando...
                                    </span>
                                </button>
                            </div>
                        </div>



                        <!-- Paso 3: Resultados -->
                        <div class="wizard-step" data-step="3">
                            <div id="resultados-container" class="resultados-container-hidden">
                                <!-- Los resultados se cargar√°n aqu√≠ din√°micamente -->
                            </div>
                            
                            <div id="error-container" class="error-message error-container-hidden">
                                <h3>Error en el c√°lculo</h3>
                                <p id="error-text"></p>
                                <button type="button" class="btn btn--secondary" onclick="goToStep(2)">
                                    Volver a intentar
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Navegaci√≥n del Wizard -->
                    <div class="wizard-navigation">
                        <button type="button" id="prev-btn" class="btn btn--secondary prev-btn-hidden">
                            ‚Üê Anterior
                        </button>
                        <button type="button" id="next-btn" class="btn btn--primary">
                            Siguiente ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Panel de Informaci√≥n Adicional -->
            <div class="simulador-info-panel">
                <div class="info-sticky">
                    <div class="info-card">
                        <h3>¬øPor qu√© elegir INGLAT?</h3>
                        <ul class="info-list">
                            <li>
                                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Pag√°s lo necesario, no m√°s
                            </li>
                            <li>
                                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Garant√≠a en la instalaci√≥n
                            </li>
                            <li>
                                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Monitorizaci√≥n en tiempo real
                            </li>
                            <li>
                                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Mantenimiento 24/7
                            </li>
                        </ul>
                    </div>

                    <div class="info-card">
                        <h3>Contacto Directo</h3>
                        <p>¬øNecesitas ayuda con el simulador?</p>
                        <div class="contact-buttons">
                            <a href="tel:+541167214369" class="btn btn--call btn--small">
                                üìû Llamar
                            </a>
                            <a href="https://wa.me/541167214369?text=Hola,%20necesito%20ayuda%20con%20el%20simulador%20solar" 
                               class="btn btn--whatsapp btn--small" 
                               target="_blank">
                                üí¨ WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Chart.js para gr√°ficos de resultados -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Script principal del simulador -->
<script src="{% static 'js/simulador.js' %}" defer></script>
{% endblock %}