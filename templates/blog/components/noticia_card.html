{% load static %}
{% load blog_extras %}

<article class="noticia-card" data-categoria="{{ noticia.categoria.slug|default:'sin-categoria' }}">
    <a href="{{ noticia.get_absolute_url }}" class="card-link">
        
        <!-- Miniatura Universal (Siempre usa miniatura, no contenido completo) -->
        <div class="card-media" data-media-type="{{ noticia.multimedia_type|default:'none' }}">
            {% with thumbnail_url=noticia.get_thumbnail_url %}
                {% if thumbnail_url %}
                    <!-- Mostrar miniatura con overlay de video si es necesario -->
                    {% if noticia.tipo_multimedia == 'video' %}
                        <div class="card-video-preview" data-platform="{{ noticia.video_platform|default:'video' }}">
                            <img src="{{ thumbnail_url }}" 
                                 alt="{{ noticia.titulo }}" 
                                 class="card-image"
                                 loading="lazy"
                                 decoding="async"
                                 fetchpriority="low"
                                 style="object-fit: cover; width: 100%; height: 100%; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;">
                            <!-- Overlay con icono de play para videos -->
                            <div class="video-overlay">
                                <i class="fas fa-play-circle fa-2x" style="color: white; opacity: 0.9;"></i>
                            </div>
                        </div>
                    {% else %}
                        <!-- Imagen simple sin overlay -->
                        <img src="{{ thumbnail_url }}" 
                             alt="{{ noticia.titulo }}" 
                             class="card-image"
                             loading="lazy"
                             decoding="async"
                             fetchpriority="low"
                             style="object-fit: cover; width: 100%; height: 100%; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;">
                    {% endif %}
                
                {% elif noticia.video_vimeo_id %}
                    <!-- Fallback legacy para Vimeo existente -->
                    <div class="card-video-preview" data-platform="vimeo-legacy">
                        <img src="https://vumbnail.com/{{ noticia.video_vimeo_id }}.jpg" 
                             alt="{{ noticia.titulo }}" 
                             class="card-image"
                             loading="lazy"
                             decoding="async"
                             fetchpriority="low">
                        <div class="video-overlay">
                            <i class="fas fa-play-circle fa-2x" style="color: white; opacity: 0.9;"></i>
                        </div>
                    </div>
                
                {% else %}
                    <!-- Placeholder cuando no hay miniatura disponible -->
                    <div class="card-placeholder">
                        {% if noticia.tipo_multimedia == 'video' %}
                            <i class="fas fa-play-circle fa-3x" style="color: white;"></i>
                            <span style="color: white; margin-top: 8px; font-size: 14px;">Video disponible</span>
                        {% elif noticia.tipo_multimedia == 'imagen' %}
                            <i class="fas fa-image fa-3x" style="color: white;"></i>
                            <span style="color: white; margin-top: 8px; font-size: 14px;">Imagen disponible</span>
                        {% else %}
                            <i class="fas fa-newspaper fa-3x" style="color: white;"></i>
                            <span style="color: white; margin-top: 8px; font-size: 14px;">Sin multimedia</span>
                        {% endif %}
                    </div>
                {% endif %}
            {% endwith %}
            
            <!-- Badge de Categoría -->
            {% if noticia.categoria %}
            <div class="card-categoria-badge" style="background-color: {{ noticia.categoria.color }};">
                <i class="{{ noticia.categoria.icono }}"></i>
                {{ noticia.categoria.nombre }}
            </div>
            {% endif %}
            
            <!-- Badge de Destacada -->
            {% if noticia.destacada %}
            <div class="card-destacada-badge">
                <i class="fas fa-star"></i>
                Destacada
            </div>
            {% endif %}
        </div>
        
        <!-- Contenido de la Tarjeta -->
        <div class="card-content">
            <header class="card-header">
                <h3 class="card-titulo">{{ noticia.titulo }}</h3>
                
                <div class="card-meta">
                    <time class="card-fecha" datetime="{{ noticia.fecha_publicacion|date:'c' }}">
                        <i class="fas fa-calendar-alt"></i>
                        {{ noticia.fecha_formateada }}
                    </time>
                    
                    <span class="card-lectura">
                        <i class="fas fa-clock"></i>
                        {{ noticia.tiempo_lectura }}
                    </span>
                </div>
            </header>
            
            <div class="card-body">
                <p class="card-descripcion">{{ noticia.descripcion_corta }}</p>
            </div>
            
            <footer class="card-footer">
                <div class="card-autor">
                    <i class="fas fa-user"></i>
                    {{ noticia.autor }}
                </div>
                
                <div class="card-cta">
                    <span class="leer-mas">
                        Leer más
                        <i class="fas fa-arrow-right"></i>
                    </span>
                </div>
            </footer>
        </div>
    </a>
</article>